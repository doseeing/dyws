!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dyws=t():e.dyws=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),r.d(t,"createDYWebsocket",(function(){return i}));class n{static encode(e,t){if("string"==typeof e)return e;var r=Object.prototype.toString.call(e),o="[object Array]"===r,i="[object Object]"===r&&(null===Object.getPrototypeOf(e)||Object===e.constructor);return o||i?Object.keys(e).reduce((function(t,r){return t+(o?"":r.replace(/@|\//g,(function(e){return"@"+("@"===e?"A":"S")}))+"@=")+n.encode(e[r],!0).replace(/@|\//g,(function(e){return"@"+("@"===e?"A":"S")}))+"/"}),""):(t||console.error("%c [@shark/net - encode]: Illegal parameter!\n  The argument must be a valid string, a plain object or a array!!!","color: #f0f; font-size: 20px;",e),t?String(e):"")}static decode(e){var t,r;if("string"==typeof e&&e){for(var n="/"!==e.charAt(e.length-1)?e.concat("/"):e,o=n.length,i=/@=/g.test(n)?{}:[],c=0,f="",s="";c<o;){var u=n.charAt(c);if("/"===u)Array.isArray(i)?i.push(s):(i[f]=s,f=(t=["",""])[0],s=t[1]);else if("@"===u)switch(c+=1,n.charAt(c)){case"A":s+="@";break;case"S":s+="/";break;case"=":f=(r=[s,""])[0],s=r[1]}else s+=u;c+=1}return i}console.error("%c [@shark/net - decode]: Illegal parameter!\n  The argument must be a valid string!!!","color: #f0f; font-size: 20px;",e)}}class o{constructor(){this.buffer=new ArrayBuffer(0),this.decoder=new TextDecoder,this.encoder=new TextEncoder,this.littleEndian=!0,this.readLength=0}concat(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce((function(e,t){var r=t instanceof ArrayBuffer?new Uint8Array(t):t,n=new Uint8Array(e.length+r.length);return n.set(e,0),n.set(r,e.length),n}),new Uint8Array(0))}decode(e,t,r){for(void 0===r&&(r=this.littleEndian),this.buffer=this.concat(this.buffer,e).buffer,this.buffer&&this.buffer.byteLength;;){if(0===this.readLength){if(this.buffer.byteLength<4)return;this.readLength=new DataView(this.buffer).getUint32(0,r),this.buffer=this.buffer.slice(4)}if(this.buffer.byteLength<this.readLength)return;var n=this.decoder.decode(this.buffer.slice(8,this.readLength-1));this.buffer=this.buffer.slice(this.readLength),this.readLength=0,t(n)}}encode(e,t){void 0===t&&(t=this.littleEndian);var r=8+(e=this.concat(this.encoder.encode(e),Uint8Array.of(0))).length,n=new DataView(new ArrayBuffer(r+4)),o=0;return n.setUint32(o,r,t),o+=4,n.setUint32(o,r,t),o+=4,n.setInt16(o,689,t),o+=2,n.setInt8(o,0),o+=1,n.setInt8(o,0),o+=1,new Uint8Array(n.buffer).set(e,o),n.buffer}}function i(e,t,r){void 0===r&&(r={});const i=new o;function c(e){const t=n.encode(e);return i.encode(t)}const f=r.url||"wss://danmuproxy.douyu.com:8501";let s=new WebSocket(f);s.binaryType="arraybuffer";let u=null;return s.onopen=function(t){const n={type:"loginreq",roomid:e};s.send(c(n));const o=r.keepLiveIntervalSecond||45;u=setInterval((function(){s.send(c({type:"mrkl"}))}),1e3*o)},s.onclose=function(e){null!==u&&clearInterval(u),void 0!==t.onClose&&t.onClose()},s.onmessage=function(o){var f,u;f=o.data,u=function(n,o){if(t.onMessage(o),"loginres"===o.type){const t={type:"joingroup",rid:e,gid:r.group||"-9999"};s.send(c(t))}},i.decode(f,(function(e){const t=n.decode(e);return u(null,t)}))},s.onerror=function(e){},s}}])}));